<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>initial_notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-dae3192f81785cf0e6fe7ca13257d296.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="floating quarto-light">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#prerequisite-studies" id="toc-prerequisite-studies" class="nav-link active" data-scroll-target="#prerequisite-studies">Prerequisite Studies</a>
  <ul class="collapse">
  <li><a href="#tolerance-intervals" id="toc-tolerance-intervals" class="nav-link" data-scroll-target="#tolerance-intervals">Tolerance Intervals</a>
  <ul class="collapse">
  <li><a href="#parametric-tolerance-intervals" id="toc-parametric-tolerance-intervals" class="nav-link" data-scroll-target="#parametric-tolerance-intervals">Parametric Tolerance Intervals</a></li>
  <li><a href="#nonparametric-tolerance-intervals" id="toc-nonparametric-tolerance-intervals" class="nav-link" data-scroll-target="#nonparametric-tolerance-intervals">Nonparametric Tolerance Intervals</a></li>
  <li><a href="#univariate-example" id="toc-univariate-example" class="nav-link" data-scroll-target="#univariate-example">Univariate Example</a></li>
  </ul></li>
  <li><a href="#lognormal-normal-distribution" id="toc-lognormal-normal-distribution" class="nav-link" data-scroll-target="#lognormal-normal-distribution">Lognormal &amp; normal distribution</a></li>
  <li><a href="#kernel-density-estimation" id="toc-kernel-density-estimation" class="nav-link" data-scroll-target="#kernel-density-estimation">Kernel Density Estimation</a></li>
  <li><a href="#probability-integral-transform" id="toc-probability-integral-transform" class="nav-link" data-scroll-target="#probability-integral-transform">Probability Integral Transform</a></li>
  </ul></li>
  <li><a href="#nonparametric-simultaneous-tolerance-intervals-for-small-dimensions-based-on-kernel-density-estimates" id="toc-nonparametric-simultaneous-tolerance-intervals-for-small-dimensions-based-on-kernel-density-estimates" class="nav-link" data-scroll-target="#nonparametric-simultaneous-tolerance-intervals-for-small-dimensions-based-on-kernel-density-estimates">Nonparametric simultaneous tolerance intervals for small dimensions based on kernel density estimates</a>
  <ul class="collapse">
  <li><a href="#abstract" id="toc-abstract" class="nav-link" data-scroll-target="#abstract">Abstract</a></li>
  <li><a href="#definitions" id="toc-definitions" class="nav-link" data-scroll-target="#definitions">More Definitions</a></li>
  <li><a href="#methodology" id="toc-methodology" class="nav-link" data-scroll-target="#methodology">Methodology</a>
  <ul class="collapse">
  <li><a href="#data-layout-statistical-criterion" id="toc-data-layout-statistical-criterion" class="nav-link" data-scroll-target="#data-layout-statistical-criterion">Data layout &amp; statistical criterion</a></li>
  <li><a href="#two-sided-stis" id="toc-two-sided-stis" class="nav-link" data-scroll-target="#two-sided-stis">Two sided STIs</a></li>
  <li><a href="#one-sided-sti" id="toc-one-sided-sti" class="nav-link" data-scroll-target="#one-sided-sti">One sided STI</a></li>
  <li><a href="#method-nonparametric-two-sided-stis" id="toc-method-nonparametric-two-sided-stis" class="nav-link" data-scroll-target="#method-nonparametric-two-sided-stis">Method: Nonparametric two-sided STIs</a></li>
  <li><a href="#evaluation-nonparametric-two-sided-stis" id="toc-evaluation-nonparametric-two-sided-stis" class="nav-link" data-scroll-target="#evaluation-nonparametric-two-sided-stis">Evaluation: Nonparametric two-sided STIs</a></li>
  <li><a href="#simulation-a-full-simulation" id="toc-simulation-a-full-simulation" class="nav-link" data-scroll-target="#simulation-a-full-simulation">Simulation A: Full Simulation</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="prerequisite-studies" class="level1">
<h1>Prerequisite Studies</h1>
<section id="tolerance-intervals" class="level2">
<h2 class="anchored" data-anchor-id="tolerance-intervals">Tolerance Intervals</h2>
<ul>
<li>an interval that contains at least a specified proportion <span class="math inline">\(\gamma\)</span> of the population, with a specified degree of confidence, <span class="math inline">\(100 \left( 1 - \alpha\right)\%\)</span></li>
<li>Let <span class="math inline">\(\mathcal{X} = \left\{ X_1, X_2, \dots, X_n \right\}\)</span> be a random sample from univariate distribution <span class="math inline">\(F(\cdot)\)</span> and suppose <span class="math inline">\(X \sim F(\cdot)\)</span>, where <span class="math inline">\(X\)</span> is independent of the random sample, then a subset of <span class="math inline">\(\mathbb{R}\)</span>, say <span class="math inline">\(T = T (\mathcal{X})\)</span>, computed from the random sample, is a <span class="math inline">\(\gamma\)</span>-content <span class="math inline">\(100 \left( 1 - \alpha\right)\%\)</span>-confidence tolerance interval for <span class="math inline">\(X\)</span> if it satisfies the ff: (The probability (over all possible samples <span class="math inline">\(\mathcal{X}\)</span>) that the tolerance interval <span class="math inline">\(T\)</span> constructed from the sample will capture at least a proportion <span class="math inline">\(\gamma\)</span> of the population is equal to <span class="math inline">\(1-\alpha\)</span>)</li>
<li><em>If I keep collecting samples and building intervals over and over, then 95% of the time, those intervals will contain at least 90% of the population.</em> - That’s a (<span class="math inline">\(\gamma\)</span>, <span class="math inline">\(1-\alpha\)</span>) tolerance interval.</li>
</ul>
<p><span class="math display">\[
P_{\mathcal{X}} \left\{ P_X \left( X \in T \mid \mathcal{X} \right) \geq \gamma \right\} = 1 - \alpha
\]</span></p>
<ul>
<li>set <span class="math inline">\(T\)</span> could be of the form:
<ul>
<li><span class="math inline">\(\left( L(\mathcal{X}), U(\mathcal{X}) \right)\)</span> for a two-sided tolerance interval</li>
<li><span class="math inline">\(\left(-\infty, U(\mathcal{X}) \right)\)</span> for a one-sided upper tolerance interval</li>
<li><span class="math inline">\(\left( L(\mathcal{X}), +\infty) \right)\)</span> for a one-sided lower tolerance interval</li>
<li><span class="math inline">\(U(\mathcal{X})\)</span> and <span class="math inline">\(L(\mathcal{X})\)</span>: upper and lower tolerance limits</li>
</ul></li>
<li>sample use case: deriving appropriate process capability limits (<span class="math inline">\(U(\mathcal{X})\)</span> and <span class="math inline">\(L(\mathcal{X})\)</span>) for a manufactured product (<span class="math inline">\(X\)</span>), so that with a given level of confidence (<span class="math inline">\(1 - \alpha\)</span>), they contain the capability measurements of at least a specified proportion of units (<span class="math inline">\(\gamma\)</span>) from the sampled manufacturing process (ie, gusto mo may confidence ka na yung tolerance interval mo, contains <span class="math inline">\(\gamma\)</span> proportion nung samples)</li>
<li>two-sided interval
<ul>
<li>What interval will contain <span class="math inline">\(p\)</span> percent of the population measurements?<br>
</li>
<li>Lower tolerance limit: <span class="math inline">\(Y_L = \hat{Y} - k_2s\)</span></li>
<li>Upper tolerance limit: <span class="math inline">\(Y_L = \hat{Y} + k_2s\)</span></li>
</ul></li>
<li>one-sided intervals
<ul>
<li>What interval guarantees that <span class="math inline">\(p\)</span> percent of population measurements will not fall below a lower limit? Lower tolerance limit: <span class="math inline">\(Y_L = \hat{Y} - k_1s\)</span></li>
<li>What interval guarantees that <span class="math inline">\(p\)</span> percent of population measurements will not exceed an upper limit? Lower tolerance limit: <span class="math inline">\(Y_U = \hat{Y} + k_1s\)</span></li>
</ul></li>
</ul>
<section id="parametric-tolerance-intervals" class="level3">
<h3 class="anchored" data-anchor-id="parametric-tolerance-intervals">Parametric Tolerance Intervals</h3>
<ul>
<li>Use the method for a parametric distribution if you can safely assume that your sample comes from a population that follows that distribution.</li>
<li>If your data follow a parametric distribution, then a method that uses that distribution is more precise and economical than the nonparametric method. A method that uses a distribution achieves smaller margins of error with fewer observations, as long as the chosen distribution is appropriate for your data.</li>
</ul>
<p><a href="https://support.minitab.com/en-us/minitab/help-and-how-to/quality-and-process-improvement/quality-tools/how-to/tolerance-intervals-nonnormal-distribution/interpret-the-results/all-statistics-and-graphs/tolerance-intervals/#parametric-distribution-method">Minitab</a></p>
</section>
<section id="nonparametric-tolerance-intervals" class="level3">
<h3 class="anchored" data-anchor-id="nonparametric-tolerance-intervals">Nonparametric Tolerance Intervals</h3>
<ul>
<li>Suppose <span class="math inline">\(X_{(1)}, X_{(2)}, \dots, X_{(n)}\)</span> are order statistics of a random sample from a population with a univariate continuous distribution function <span class="math inline">\(F(x)\)</span>.</li>
<li>Wilk’s approach: 2 sided interval
<ul>
<li>sets values <span class="math inline">\(L(\mathcal{X}) = X_{(r)}\)</span> and <span class="math inline">\(U(\mathcal{X}) = X_{(s)}\)</span> where <span class="math inline">\(r &lt; s\)</span>, as the limits of the <span class="math inline">\(\gamma\)</span>-content <span class="math inline">\(100 \left( 1 - \alpha\right)\%\)</span>-confidence tolerance interval <span class="math inline">\(\left( L(\mathcal{X}), U(\mathcal{X}) \right)\)</span></li>
<li>The values of <span class="math inline">\(r\)</span> and <span class="math inline">\(s\)</span> are chosen to satisfy <span class="math inline">\(1 \le r \le s \le n\)</span> and <span class="math inline">\(s-r=m\)</span> where <span class="math inline">\(m\)</span> is the smallest value for which <span class="math inline">\(P(Y \le m-1) \ge 1-\alpha\)</span>, and <span class="math inline">\(Y \sim \text{Binomial}(n, \gamma)\)</span>. It is customary to take the value of <span class="math inline">\(s\)</span> to be equal to <span class="math inline">\(n-r+1\)</span>, as suggested by Wilks et.al. so that</li>
<li>the nonparametric interval is given by <span class="math inline">\((X_{(r)}, X_{(n-r+1)})\)</span></li>
</ul></li>
<li>Wilk’s approach: 1 sided interval: Lower tolerance limit
<ul>
<li>sets <span class="math inline">\(L(\mathcal{X}) = X_{(r)}\)</span> as the lower limit of the <span class="math inline">\(\gamma\)</span>-content <span class="math inline">\(100 \left( 1 - \alpha\right)\%\)</span>-confidence tolerance interval.</li>
<li>The value of <span class="math inline">\(r\)</span> is taken to be the largest integer for which <span class="math inline">\(P(Y \ge r \mid n, 1- \gamma) \ge 1 - \alpha\)</span> where <span class="math inline">\(Y \sim \text{Binomial}(n, 1-\gamma)\)</span>.</li>
<li>The non parametric one-sided lower tolerance interval is given by <span class="math inline">\((X_{(r)}, \infty)\)</span></li>
</ul></li>
<li>Wilk’s approach: 1 sided interval: Upper tolerance limit
<ul>
<li>sets <span class="math inline">\(U(\mathcal{X}) = X_{S}\)</span>, where it can be shown that</li>
<li><span class="math inline">\(s=n-r+1\)</span> and <span class="math inline">\(r\)</span> is the value derived for the lower tolerance limit.</li>
<li>The nonparametric one-sided upper tolerance interval is given by <span class="math inline">\((-\infty, X_{(n-r+1)})\)</span></li>
</ul></li>
<li>There is a minimum sample size requirement in computing the nonparametric tolerance intervals. This depends on the values of <span class="math inline">\(\gamma\)</span> and <span class="math inline">\(1-\alpha\)</span></li>
<li>The coverage probabilities associated with nonparametric tolerance intervals are known to be conservative.</li>
<li>Although in this study we shall only be using Wilks’ approach, we mention that recently some developments aimed at improving coverage probabilities of nonparametric tolerance intervals have been available in literature.</li>
</ul>
</section>
<section id="univariate-example" class="level3">
<h3 class="anchored" data-anchor-id="univariate-example">Univariate Example</h3>
<p>Suppose that we take a sample of <span class="math inline">\(N=25\)</span> silicon wafers from a lot and measure their thickness in order to find tolerance limits within which a proportion <span class="math inline">\(p = 0.90\)</span> of the wafers in the lot fall with confidence <span class="math inline">\(\alpha = 0.99\)</span>. Since the standard deviation, <span class="math inline">\(s\)</span>, is computed from the sample of 25 wafers, the degree of freedom is <span class="math inline">\(\nu = N - 1\)</span></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">The data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Parametric approach</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Nonparametric approach</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## "Direct" calculation of a tolerance interval.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Read data and name variables.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># URL of the dataset</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#url &lt;- "https://www.itl.nist.gov/div898/handbook/datasets/MPC62.DAT"</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Download the file (you can specify a path where you want to save it)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># download.file(url, destfile = "MPC62.DAT")</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the dataset into R</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>mdat <span class="ot">=</span> <span class="fu">read.table</span>(<span class="st">"MPC62.DAT"</span>,<span class="at">header=</span><span class="cn">FALSE</span>, <span class="at">skip=</span><span class="dv">50</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mdat) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"cr"</span>, <span class="st">"wafer"</span>, <span class="st">"mo"</span>, <span class="st">"day"</span>, <span class="st">"h"</span>, <span class="st">"min"</span>, <span class="st">"op"</span>, </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"hum"</span>, <span class="st">"probe"</span>, <span class="st">"temp"</span>, <span class="st">"y"</span>, <span class="st">"sw"</span>, <span class="st">"df"</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mdat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     cr wafer mo day  h min op hum probe   temp      y    sw df
1 51939   137  3  24 18   1  1  42  2362 23.003 97.070 0.085  5
2 51939   137  3  25 12  41  1  35  2362 23.115 97.049 0.052  5
3 51939   137  3  25 15  57  1  33  2362 23.196 97.048 0.038  5
4 51939   137  3  28 10  10  2  47  2362 23.383 97.084 0.036  5
5 51939   137  3  28 13  31  2  44  2362 23.491 97.106 0.049  5
6 51939   137  3  28 17  33  1  43  2362 23.352 97.014 0.036  5</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tolerance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>tolerance package, version 3.0.0, Released 2024-04-18
This package is based upon work supported by the Chan Zuckerberg Initiative: Essential Open Source Software for Science (Grant No. 2020-255193).</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p><strong>Through <code>tolerance</code> package</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>pout <span class="ot">=</span> <span class="fu">normtol.int</span>(mdat<span class="sc">$</span>y, </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">alpha=</span><span class="fl">0.01</span>, <span class="co"># chosen such that 1-alpha is the conf level</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">P=</span>.<span class="dv">90</span>, <span class="co"># proportion of the pop to be covered by this TI</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">side=</span><span class="dv">2</span>, <span class="co"># 1-sided or 2-sided tolerance interval</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"HE2"</span>, <span class="co"># method for calculating the k-factors</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">m=</span><span class="dv">100</span> <span class="co"># maxnum of subintervals to use in the integrate fcn</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>pout</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  alpha   P    x.bar 2-sided.lower 2-sided.upper
1  0.01 0.9 97.06984        97.003      97.13668</code></pre>
</div>
</div>
<p><em>TI Interpretation: In this example, you can be 99% confident that at least 90% of all thickness measurements are between approximately 97.0030038 and 97.1366762.</em></p>
<p><strong>Manually deriving the endpoints:</strong></p>
<p>The <span class="math inline">\(k\)</span> factors are determined so that the intervals cover at least a proportion <span class="math inline">\(p\)</span> of the population with confidence <span class="math inline">\(\alpha\)</span>. The value of <span class="math inline">\(p\)</span> is also referred to as the coverage factor. This assumes normal distribution. This is the approximate value for <span class="math inline">\(k_2\)</span> from Howe, 1969.</p>
<p><span class="math display">\[
\sqrt{
\nu \left(1+ \frac{1}{N} \right) \times \frac {z_{\left( \frac{1+p}{2}\right)}^2}
{\chi^2_{1-\alpha, \nu}}
}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Compute the approximate k2 factor for a two-sided tolerance interval. </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="do">## For this example, the standard deviation is computed from the sample,</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="do">## so the degrees of freedom are nu = N - 1.</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="dv">25</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">=</span> N <span class="sc">-</span> <span class="dv">1</span> <span class="co"># df used to estimate the sd</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fl">0.90</span> <span class="co"># proportion</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>g <span class="ot">=</span> <span class="fl">0.99</span> <span class="co"># alpha</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>z2 <span class="ot">=</span> (<span class="fu">qnorm</span>((<span class="dv">1</span><span class="sc">+</span>p)<span class="sc">/</span><span class="dv">2</span>))<span class="sc">**</span><span class="dv">2</span> <span class="co"># critical values of the normal distribution</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>c2 <span class="ot">=</span> <span class="fu">qchisq</span>(<span class="dv">1</span><span class="sc">-</span>g,nu) <span class="co"># lower critical values of the chi-square distribution</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>k2 <span class="ot">=</span> <span class="fu">sqrt</span>(nu<span class="sc">*</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>N)<span class="sc">*</span>z2<span class="sc">/</span>c2)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>k2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.494063</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Compute the exact k2 factor for a two-sided tolerance interval using </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="do">## the K.factor function in the tolerance library</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="do">## "HE2" is a second method due to Howe, which performs similarly to the </span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Weissberg-Beatty method, but is computationally simpler</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>K2 <span class="ot">=</span> <span class="fu">K.factor</span>(<span class="at">n=</span>N, <span class="at">f=</span>nu, <span class="at">alpha=</span><span class="dv">1</span><span class="sc">-</span>g, <span class="at">P=</span>p, <span class="at">side=</span><span class="dv">2</span>, <span class="at">method=</span><span class="st">"HE2"</span>, <span class="at">m=</span><span class="dv">1000</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>K2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.494063</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>pout<span class="sc">$</span>x.bar<span class="sc">-</span>K2<span class="sc">*</span><span class="fu">sd</span>(mdat<span class="sc">$</span>y); pout<span class="sc">$</span>x.bar<span class="sc">+</span>K2<span class="sc">*</span><span class="fu">sd</span>(mdat<span class="sc">$</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 97.003</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 97.13668</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plottol</span>(pout, mdat<span class="sc">$</span>y, <span class="at">plot.type =</span> <span class="st">"both"</span>, <span class="at">side =</span> <span class="st">"two"</span>, <span class="at">x.lab =</span> <span class="st">"X"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="initial_notes_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Parametric and univariate</strong></p>
<p>Given a sample size <span class="math inline">\(n\)</span>, sample mean <span class="math inline">\(\bar{x}\)</span>, and sample standard deviation <span class="math inline">\(s\)</span>, the two-sided normal tolerance interval is:</p>
<p><span class="math display">\[
\bar{x} \pm k \cdot s
\]</span></p>
<p>where <span class="math inline">\(k\)</span> is a factor based on:</p>
<p><span class="math inline">\(n\)</span>, confidence level, <span class="math inline">\((1-\alpha)\)</span>, and population coverage <span class="math inline">\(\gamma\)</span></p>
<p>In R, to find the smallest value <span class="math inline">\(m\)</span> such that <span class="math inline">\(P(Y \le m-1) \ge 1-\alpha\)</span> for a binomial distribution <span class="math inline">\(Y \sim \text{Binomial}(n, \gamma)\)</span>, you can use the cumulative distribution function (CDF) for the Binomial distribution, which is available in the <code>pbinom()</code> function.</p>
<p>The condition <span class="math inline">\(P(Y \le m-1) \ge 1-\alpha\)</span> suggests that you are looking for the quantile <span class="math inline">\(m\)</span> such that the cumulative probability is at least <span class="math inline">\(1-\alpha\)</span>.</p>
<p><a href="https://www.itl.nist.gov/div898/handbook/prc/section2/prc263.htm">Ref</a></p>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p><strong>Through <code>tolerance</code> package</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>npout <span class="ot">=</span> <span class="fu">nptol.int</span>(mdat<span class="sc">$</span>y,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alpha =</span> <span class="fl">0.01</span>, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">P =</span> <span class="fl">0.90</span>, </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">side =</span> <span class="dv">2</span>, </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">"WILKS"</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">upper =</span> <span class="cn">NULL</span>, </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lower =</span> <span class="cn">NULL</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>npout</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  alpha   P 2-sided.lower 2-sided.upper
1  0.01 0.9        97.014        97.114</code></pre>
</div>
</div>
<p><em>TI Interpretation: You can be 99% confident that at least 90% of all thickness measurements are between approximately 97.014 and 97.114.</em></p>
<p><strong>Manually deriving the endpoints:</strong></p>
<p>Wilk’s approach: 2 sided interval<br>
- sets values <span class="math inline">\(L(\mathcal{X}) = X_{(r)}\)</span> and <span class="math inline">\(U(\mathcal{X}) = X_{(s)}\)</span> where <span class="math inline">\(r &lt; s\)</span>, as the limits of the <span class="math inline">\(\gamma\)</span>-content <span class="math inline">\(100 \left( 1 - \alpha\right)\%\)</span>-confidence tolerance interval <span class="math inline">\(\left( L(\mathcal{X}), U(\mathcal{X}) \right)\)</span><br>
- The values of <span class="math inline">\(r\)</span> and <span class="math inline">\(s\)</span> are chosen to satisfy <span class="math inline">\(1 \le r \le s \le n\)</span> and <span class="math inline">\(s-r=m\)</span> where <span class="math inline">\(m\)</span> is the smallest value for which <span class="math inline">\(P(Y \le m-1) \ge 1-\alpha\)</span>, and <span class="math inline">\(Y \sim \text{Binomial}(n, \gamma)\)</span>.<br>
- It is customary to take the value of <span class="math inline">\(s\)</span> to be equal to <span class="math inline">\(n-r+1\)</span>, as suggested by Wilks et.al. so that - the nonparametric interval is given by <span class="math inline">\((X_{(r)}, X_{(n-r+1)})\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 &lt;= r &lt; s &lt; N = 25</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># let s = n−r+1</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># s - r = (n-r+1) - r = m </span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># (n-m+1)/2 = r</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">25</span>    <span class="co"># Number of trials</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="fl">0.90</span> <span class="co"># Probability of success in each trial</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.01</span> <span class="co"># Significance level (1 - confidence level)</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the smallest m such that P(Y &lt;= m-1) &gt;= 1 - alpha ie find the </span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># smallest value of m such that the cumulative probability just reaches </span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co"># or exceeds the confidence level 1-alpha</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">qbinom</span>(<span class="dv">1</span> <span class="sc">-</span> alpha, <span class="at">size =</span> n, <span class="at">prob =</span> gamma)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>r <span class="ot">=</span> (n<span class="sc">-</span>m<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>s <span class="ot">=</span> m<span class="sc">+</span>r</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(mdat<span class="sc">$</span>y)[<span class="fu">ceiling</span>(r)]; <span class="fu">sort</span>(mdat<span class="sc">$</span>y)[<span class="fu">floor</span>(n<span class="sc">-</span>r<span class="sc">+</span><span class="dv">1</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 97.014</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 97.114</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plottol</span>(npout, mdat<span class="sc">$</span>y, <span class="at">plot.type =</span> <span class="st">"both"</span>, <span class="at">side =</span> <span class="st">"two"</span>, <span class="at">x.lab =</span> <span class="st">"X"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="initial_notes_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="lognormal-normal-distribution" class="level2">
<h2 class="anchored" data-anchor-id="lognormal-normal-distribution">Lognormal &amp; normal distribution</h2>
<p><span class="math inline">\(X \sim \mathcal{N}(\mu, \sigma^2)\)</span> means <span class="math inline">\(X\)</span> is normally distributed.</p>
<p><span class="math inline">\(Y \sim \{Lognormal}(\mu, \sigma^2)\)</span> means <span class="math inline">\(\log Y \sim \mathcal{N}(\mu, \sigma^2)\)</span></p>
<p>A <strong>lognormal random variable</strong> is one whose logarithm is normally distributed.</p>
<p>If you assume the data itself is normal (<code>norm</code>): The raw data <span class="math inline">\(X \sim \mathcal{N}(\mu, \sigma^2)\)</span>.</p>
<p>If you assume the log of the data is normal (<code>lnorm</code>): You are modeling <span class="math inline">\(\log(X) \sim \mathcal{N}(\mu, \sigma^2)\)</span> so <span class="math inline">\(X \sim \text{Lognormal}(\mu, \sigma^2)\)</span></p>
<p>Mean is zero in the log scale means <span class="math inline">\(\log(Y) \sim \mathcal{N}(0, \sigma^2)\)</span> which is equivalent to <span class="math inline">\(Y \sim \text{Lognormal}(\mu, \sigma^2)\)</span></p>
<p>This also tells that <strong>the mean of <span class="math inline">\(Y\)</span> is not 0</strong>. In fact, <span class="math inline">\(\mathbb{E}[Y] =  e^{\mu+\sigma^2/2}\)</span> so if <span class="math inline">\(\mu = 0\)</span> then, <span class="math inline">\(\mathbb{E}[Y] =  e^{\sigma^2/2} &gt; 1\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>log_x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>lnorm_x <span class="ot">&lt;-</span> <span class="fu">rlnorm</span>(<span class="dv">1000</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(log_x, <span class="at">main =</span> <span class="st">"Histogram: log(x)"</span>, <span class="at">xlab =</span> <span class="st">"log(x)"</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">exp</span>(log_x), <span class="at">main =</span> <span class="st">"exp(log_x) &amp; lnorm_x"</span>, <span class="at">xlab =</span> <span class="st">"exp(log_x) &amp; lnorm(x)"</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">xlim =</span> <span class="fu">range</span>(<span class="fu">c</span>(<span class="fu">exp</span>(log_x), lnorm_x)), <span class="at">breaks =</span> <span class="dv">30</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Overlay histogram of lnorm_x</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(lnorm_x, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.3</span>), <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">breaks =</span> <span class="dv">30</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a legend</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"log_y"</span>, <span class="st">"lnorm_x"</span>),</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="fu">c</span>(<span class="fu">rgb</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.5</span>), <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="initial_notes_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">exp</span>(log_x)<span class="sc">==</span>lnorm_x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1000</code></pre>
</div>
</div>
</section>
<section id="kernel-density-estimation" class="level2">
<h2 class="anchored" data-anchor-id="kernel-density-estimation">Kernel Density Estimation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>find_silver_bw <span class="ot">&lt;-</span> <span class="cf">function</span>(sample){</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(sample)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  iqr <span class="ot">&lt;-</span> <span class="fu">IQR</span>(sample)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(sample)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fl">0.9</span><span class="sc">*</span>n<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>)<span class="sc">*</span><span class="fu">min</span>(<span class="fu">c</span>(sd, iqr<span class="sc">/</span><span class="fl">1.34</span>)))</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>get_grid <span class="ot">&lt;-</span> <span class="cf">function</span>(sample){</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  lb <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">sort</span>(sample)) <span class="sc">-</span> <span class="fu">sd</span>(sample)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  ub <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">sort</span>(sample)) <span class="sc">+</span> <span class="fu">sd</span>(sample)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">seq</span>(<span class="at">from=</span>lb, <span class="at">to=</span>ub, <span class="at">by=</span><span class="fl">0.0001</span>))</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>gaussian_kernel <span class="ot">&lt;-</span> <span class="cf">function</span>(bandwidth, grid, datapoint) {</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>((<span class="dv">1</span><span class="sc">/</span>(bandwidth<span class="sc">*</span><span class="fu">sqrt</span>(<span class="dv">2</span><span class="sc">*</span>pi))) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>((grid<span class="sc">-</span>datapoint)<span class="sc">/</span>bandwidth)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co">#  return((1 / sqrt(2 * pi)) * exp(-0.5 * u^2))</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>kde_manual <span class="ot">&lt;-</span> <span class="cf">function</span>(grid, datapoints, bandwidth) {</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(datapoints)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(grid, <span class="cf">function</span>(grid_val) {</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(<span class="fu">gaussian_kernel</span>(bandwidth, grid_val, datapoints) <span class="sc">/</span> n)</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>kde_manual_presum <span class="ot">&lt;-</span> <span class="cf">function</span>(grid, datapoints, bandwidth) {</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(datapoints)</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(grid, <span class="cf">function</span>(grid_val) {</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gaussian_kernel</span>(bandwidth, grid_val, datapoints)</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a><span class="co"># KDE for CDF estimation using Gaussian kernel</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>kde_cdf <span class="ot">&lt;-</span> <span class="cf">function</span>(grid, datapoints, bandwidth) {</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(grid, <span class="cf">function</span>(grid_val) {</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="fu">pnorm</span>((grid_val <span class="sc">-</span> datapoints) <span class="sc">/</span> bandwidth))</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="https://medium.com/analytics-vidhya/kernel-density-estimation-kernel-construction-and-bandwidth-optimization-using-maximum-b1dfce127073">Reference 1</a> <a href="https://rpubs.com/mcocam12/kdf_byhand">Plotting KDE</a></p>
<p>Kernel - Kernel functions are used to estimate density of random variables and as weighing function in non-parametric regression.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>x_data <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">c</span>(<span class="dv">65</span>, <span class="dv">75</span>, <span class="dv">67</span>, <span class="dv">79</span>, <span class="dv">81</span>, <span class="dv">91</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>x_data_sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(x_data)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>x_data_iqr <span class="ot">&lt;-</span> <span class="fu">IQR</span>(x_data)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>x_data_n <span class="ot">&lt;-</span> <span class="fu">length</span>(x_data)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>h_silver <span class="ot">&lt;-</span> <span class="fl">0.9</span><span class="sc">*</span>x_data_n<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>)<span class="sc">*</span><span class="fu">min</span>(<span class="fu">c</span>(x_data_sd, x_data_iqr<span class="sc">/</span><span class="fl">1.34</span>))</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>xi <span class="ot">&lt;-</span> <span class="dv">65</span><span class="co">#x_data[1]</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fl">5.5</span> <span class="co">#h_silver</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>min_val <span class="ot">&lt;-</span> <span class="dv">40</span><span class="co">#min(x_data)-round(h)</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>max_val <span class="ot">&lt;-</span> <span class="dv">120</span><span class="co">#max(x_data)+round(h)</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> min_val, <span class="at">to =</span> max_val, <span class="at">by =</span> <span class="dv">1</span>) <span class="co"># grid</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate PDF</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>outmat <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">kde_manual_presum</span>(x, x_data, h))</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>estimated_density <span class="ot">&lt;-</span> <span class="fu">kde_manual</span>(x, x_data, h)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate CDF</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>estimated_cdf <span class="ot">&lt;-</span> <span class="fu">kde_cdf</span>(x, x_data, h)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(outmat) <span class="ot">&lt;-</span> x</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(outmat) <span class="ot">&lt;-</span> x_data</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">grid =</span> <span class="fu">rownames</span>(outmat), outmat)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(outmat) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(outmat)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mat,as.numeric) <span class="sc">%&gt;%</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">colnames</span>(outmat), <span class="at">names_to =</span> <span class="st">"sample"</span>, <span class="at">values_to =</span> <span class="st">"k"</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>df_long<span class="sc">$</span>grid <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df_long<span class="sc">$</span>grid)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>df_long<span class="sc">$</span>sample <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df_long<span class="sc">$</span>sample)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>df_long<span class="sc">$</span>k <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df_long<span class="sc">$</span>k)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> df_long <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">norm_kern =</span> k<span class="sc">/</span><span class="dv">6</span>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>comp <span class="ot">&lt;-</span> df_long <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(grid) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">composite=</span><span class="fu">sum</span>(k)<span class="sc">/</span>x_data_n)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_long, <span class="fu">aes</span>(<span class="at">x =</span> grid, <span class="at">y =</span> norm_kern, <span class="at">color =</span> sample, <span class="at">group =</span> sample), <span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> comp, <span class="fu">aes</span>(<span class="at">x =</span> grid, <span class="at">y =</span> composite), <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(min_val, max_val) <span class="sc">+</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">65</span>, <span class="dv">67</span>, <span class="dv">75</span>, <span class="dv">79</span>, <span class="dv">81</span>, <span class="dv">91</span>), <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Kernels at different data points"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="initial_notes_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>x_data <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">c</span>(<span class="dv">65</span>, <span class="dv">75</span>, <span class="dv">67</span>, <span class="dv">79</span>, <span class="dv">81</span>, <span class="dv">91</span>))</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>x_data_sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(x_data)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>x_data_iqr <span class="ot">&lt;-</span> <span class="fu">IQR</span>(x_data)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>x_data_n <span class="ot">&lt;-</span> <span class="fu">length</span>(x_data)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>h_silver <span class="ot">&lt;-</span> <span class="fl">0.9</span><span class="sc">*</span>x_data_n<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>)<span class="sc">*</span><span class="fu">min</span>(<span class="fu">c</span>(x_data_sd, x_data_iqr<span class="sc">/</span><span class="fl">1.34</span>))</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>xi <span class="ot">&lt;-</span> <span class="dv">65</span><span class="co">#x_data[1]</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> h_silver</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>min_val <span class="ot">&lt;-</span> <span class="dv">40</span><span class="co">#min(x_data)-round(h)</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>max_val <span class="ot">&lt;-</span> <span class="dv">120</span><span class="co">#max(x_data)+round(h)</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> min_val, <span class="at">to =</span> max_val, <span class="at">by =</span> <span class="dv">1</span>) <span class="co"># grid</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Approximate CDF using left Riemann sums</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>dx <span class="ot">&lt;-</span> <span class="fu">diff</span>(x)            <span class="co"># Spacing between x points (assumes equally spaced)</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>dx <span class="ot">&lt;-</span> <span class="fu">c</span>(dx, <span class="fu">tail</span>(dx, <span class="dv">1</span>))      <span class="co"># Pad to same length</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>cdf_from_pdf <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(comp[[<span class="st">'composite'</span>]] <span class="sc">*</span> dx)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, cdf_from_pdf, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>,</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"x"</span>, <span class="at">ylab =</span> <span class="st">"Estimated CDF"</span>,</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Estimated CDFs Comparison"</span>)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, estimated_cdf, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">ecdf</span>(x_data)(x), <span class="at">col =</span> <span class="st">"darkgreen"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, </span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Numerical Integration"</span>, <span class="st">"Kernel CDF (pnorm)"</span>, <span class="st">"Empirical CDF"</span>),</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"darkgreen"</span>), </span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), </span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="initial_notes_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>exp_log_x <span class="ot">&lt;-</span> <span class="fu">exp</span>(log_x)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fu">find_silver_bw</span>(exp_log_x)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>estimated_cdf_sim <span class="ot">&lt;-</span> <span class="fu">kde_cdf</span>(<span class="fu">get_grid</span>(exp_log_x), exp_log_x, h)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>estimated_pdf_sim <span class="ot">&lt;-</span> <span class="fu">kde_manual</span>(<span class="fu">get_grid</span>(exp_log_x), exp_log_x, h)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>get_grid_exp_log_x <span class="ot">&lt;-</span> <span class="fu">get_grid</span>(exp_log_x)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">exp</span>(log_x), <span class="at">main =</span> <span class="st">"Histogram: exp(log_x)"</span>, <span class="at">xlab =</span> <span class="st">"exp(log_x)"</span>,</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">xlim =</span> <span class="fu">range</span>(<span class="fu">c</span>(<span class="fu">exp</span>(log_x), lnorm_x)), <span class="at">breaks =</span> <span class="dv">30</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(get_grid_exp_log_x, estimated_cdf_sim, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"red"</span>,</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"exp(log_x)"</span>, <span class="at">ylab =</span> <span class="st">"KDE-Estimated CDF"</span>,</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Estimated CDF"</span>)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(get_grid_exp_log_x, estimated_pdf_sim, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"red"</span>,</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"exp(log_x)"</span>, <span class="at">ylab =</span> <span class="st">"KDE-Estimated PDF"</span>,</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Estimated PDF"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="initial_notes_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"GoFKernel"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: KernSmooth</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>KernSmooth 2.23 loaded
Copyright M. P. Wand 1997-2009</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># kde_cdf_value &lt;- function(x, datapoints, bandwidth) {</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   mean(pnorm((x - datapoints) / bandwidth))</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>kde_cdf_function <span class="ot">&lt;-</span> <span class="cf">function</span>(datapoints, bandwidth) {</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">mean</span>(<span class="fu">pnorm</span>((x <span class="sc">-</span> datapoints) <span class="sc">/</span> bandwidth))</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co"># kde_cdf_inverse &lt;- function(probabilities, datapoints, bandwidth, lower = -10, upper = 10) {</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   sapply(probabilities, function(p) {</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     root_func &lt;- function(x) kde_cdf_value(x, datapoints, bandwidth) - p</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     uniroot(root_func, lower = lower, upper = upper)$root</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   })</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>kde_cdf_function <span class="ot">&lt;-</span> <span class="cf">function</span>(datapoints, bandwidth) {</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">mean</span>(<span class="fu">pnorm</span>((x <span class="sc">-</span> datapoints) <span class="sc">/</span> bandwidth))</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>get_upper_limit <span class="ot">&lt;-</span> <span class="cf">function</span>(p_data){</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> <span class="fu">find_silver_bw</span>(p_data)</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>  cdf_j <span class="ot">&lt;-</span> <span class="fu">kde_cdf_function</span>(p_data, h)</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>  U_mat <span class="ot">&lt;-</span> <span class="fu">sapply</span>(p_data, cdf_j)</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  Y_mat <span class="ot">&lt;-</span> <span class="fu">pmax</span>(U_mat, <span class="dv">1</span> <span class="sc">-</span> U_mat)</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>  npout <span class="ot">=</span> <span class="fu">nptol.int</span>(Y_mat, <span class="at">alpha =</span> alpha, <span class="at">P =</span> gamma, <span class="at">side =</span> <span class="dv">1</span>, <span class="at">method =</span> <span class="st">"WILKS"</span>,</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>                  <span class="at">upper =</span> <span class="cn">NULL</span>, <span class="at">lower =</span> <span class="cn">NULL</span>)</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(npout<span class="sc">$</span><span class="st">`</span><span class="at">1-sided.upper</span><span class="st">`</span>)</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>get_tolerance_interval <span class="ot">&lt;-</span> <span class="cf">function</span>(p_data, <span class="at">maxk=</span><span class="fu">max</span>(k_j)){</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> <span class="fu">find_silver_bw</span>(p_data)</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>  cdf_fun <span class="ot">&lt;-</span> <span class="fu">kde_cdf_function</span>(p_data,h)</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>  inv_cdf <span class="ot">&lt;-</span> <span class="fu">inverse</span>(cdf_fun,<span class="at">lower=</span><span class="fu">min</span>(p_data) <span class="sc">-</span> <span class="dv">3</span> <span class="sc">*</span> h,<span class="at">upper=</span><span class="fu">max</span>(p_data) <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> h)</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>  lower_bound <span class="ot">&lt;-</span> <span class="fu">inv_cdf</span>(<span class="dv">1</span> <span class="sc">-</span> maxk)</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>  upper_bound <span class="ot">&lt;-</span> <span class="fu">inv_cdf</span>(maxk)</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(lower_bound, upper_bound))</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="probability-integral-transform" class="level2">
<h2 class="anchored" data-anchor-id="probability-integral-transform">Probability Integral Transform</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">kde_cdf</span>(<span class="fu">exp</span>(log_x), <span class="fu">exp</span>(log_x), <span class="fu">find_silver_bw</span>(<span class="fu">exp</span>(log_x))), <span class="at">probability =</span> <span class="cn">TRUE</span>, </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Histogram of PIT-transformed values"</span>,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"PIT values"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="initial_notes_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><a href="https://matthewfeickert.github.io/Statistics-Notes/notebooks/Introductory/probability-integral-transform.html">Probability Integral Transform</a></p>
</section>
</section>
<section id="nonparametric-simultaneous-tolerance-intervals-for-small-dimensions-based-on-kernel-density-estimates" class="level1">
<h1>Nonparametric simultaneous tolerance intervals for small dimensions based on kernel density estimates</h1>
<section id="abstract" class="level2">
<h2 class="anchored" data-anchor-id="abstract">Abstract</h2>
<ul>
<li>This study aims to contribute to the existing knowledge on the computation of STIs by developing procedures to compute nonparametric STIs with accurate coverage.<br>
</li>
<li>The tolerance interval’s property of containing a specified proportion of sampled population values with high degree of confidence makes its computation meaningful.<br>
</li>
<li>Whenever there are several populations, it may be of interest to perform simultaneous inference. For this reason, this study proposes methods to construct simultaneous tolerance intervals (STIs).<br>
</li>
<li>Furthermore, since in many cases of practical applications the underlying distribution is unknown, the proposed STIs are derived under a nonparametric setting.<br>
</li>
<li>The proposed procedures andalgorithms are then assessed through performance metrics, such as estimated coverage probabilities and expected lengths.<br>
</li>
<li>The performance of the proposed methodology is also compared with the Bonferroni correction approach.<br>
</li>
<li>The proposed methods show accurate results, with coverage probabilities close to the nominal level.<br>
</li>
<li>The nonparametric STIs computed using the proposed methods are generally better than the ones obtained through a Bonferroni-corrected approach.<br>
</li>
<li>A real-life application on the assessment of liver function is presented to illustrate the use of the proposed method.</li>
</ul>
</section>
<section id="definitions" class="level2">
<h2 class="anchored" data-anchor-id="definitions">More Definitions</h2>
<p><strong>Simultaneous inference</strong><br>
- Whenever there are several populations, it is of interest to construct simultaneous statistical intervals from the sample data.<br>
- Having several simultaneous interval estimates that are naïvely constructed only increases the likelihood that at least one of such inferential statements does not hold true.<br>
- For this reason, this study considers integrating the criteria for simultaneous inference in computing statistical tolerance intervals so that the resulting coverage probabilities are close to the nominal confidence level.</p>
<p><strong>Current studies</strong><br>
- The STIs that are available in literature rely on the assumption of normality. However, in many applications, this assumption is unwarranted. For instance, Wright and Royston (1999) point out that positive skewness is common among laboratory measurements, which are the bases for the construction of reference intervals. Thus, there is a need to establish STIs through nonparametric means.<br>
- While approaches to compute nonparametric tolerance regions are available in some existing studies [see, for instance Young and Mathew (2020) and Lucagbo (2021)], these studies do not use the criterion for simultaneous inference.</p>
<p><strong>Kernel density estimation</strong><br>
- The methodologies proposed in this study involve estimating the Cumulative Distribution Function (CDF) through kernel density estimation (KDE), which is a generalization of density estimation through histograms.<br>
- A weight function in histogram construction is simply replaced by another function, called the kernel function, denoted by <span class="math inline">\(K(\cdot)\)</span>, which satisfies the ff conditions: <span class="math inline">\(K(\cdot) \ge 0\)</span> and <span class="math inline">\(\int^{\infty}_{-\infty} K(x) dx = 1\)</span><br>
- This function is often taken as a symmetric density function, such as a standard normal density function.<br>
- KDE, as a nonparametric statistical tool, estimates the unknown Probability Density Function (PDF) or CDF.<br>
- KDE Methodology: Suppose that <span class="math inline">\(X_1, X_2, \dots, X_n\)</span> is a random sample from some unknown PDF <span class="math inline">\(f(x)\)</span> and CDF <span class="math inline">\(F(x)\)</span>. Then, KDE estimates the PDF as <span class="math inline">\(\hat{f}(x) = \frac{1}{n} \sum^n_{i=1} \frac{1}{h} K \left( \frac{x-X_i}{h} \right)\)</span> where<br>
- <span class="math inline">\(h\)</span> is the bandwidth that acts as a smoothing parameter. Here, larger values of <span class="math inline">\(h\)</span> result in smoother density estimates. As it gets smaller, the density gets rougher. Optimal choices for <span class="math inline">\(h\)</span> include Silverman’s rule of thumb given by: <span class="math inline">\(h = 0.9 n^{-\frac{1}{5}} min \left\{ S, \frac{IQR}{1.34}\right\}\)</span> where <span class="math inline">\(S\)</span> is the standard deviation of the sample data and IQR is its interquartile range.<br>
- Common choices for <span class="math inline">\(K(\cdot)\)</span> include Gaussian kernel and the Epanichikov kernel.<br>
- This study uses the Gaussian kernel and estimtes the CDF by plugging the PDF of the standard normal distribution into <span class="math inline">\(K(\cdot)\)</span> and integrating the resulting quantity, giving <span class="math inline">\(\hat{F}(x)=\frac{1}{n} \sum^n_{i=1} \Phi \left( \frac{x-X_i}{h} \right)\)</span> where <span class="math inline">\(\hat{F}(x)\)</span> is the estimate of <span class="math inline">\(F(x)\)</span> and <span class="math inline">\(\Phi\)</span> is the CDF of the standard normal distribution.</p>
</section>
<section id="methodology" class="level2">
<h2 class="anchored" data-anchor-id="methodology">Methodology</h2>
<section id="data-layout-statistical-criterion" class="level3">
<h3 class="anchored" data-anchor-id="data-layout-statistical-criterion">Data layout &amp; statistical criterion</h3>
<p>Here discusses the data to be used in computing STIs and the criterion to be followed.</p>
<p><strong>Data</strong>: random sample <span class="math inline">\(\mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n\)</span> of multivariate measurements with dimension <span class="math inline">\(p\)</span>, coming from an unknown continuous distributions, say <span class="math inline">\(F_X(\cdot)\)</span>. Each <span class="math inline">\(\mathbf{X}_i = \left( X_{i1}, X_{i2}, \dots, X_{ip}\right)'\)</span> is a <span class="math inline">\((p \times 1)\)</span> column vector of measurements taken from the <span class="math inline">\(i\)</span>th subject, <span class="math inline">\(i = 1, 2, \dots, n\)</span></p>
</section>
<section id="two-sided-stis" class="level3">
<h3 class="anchored" data-anchor-id="two-sided-stis">Two sided STIs</h3>
<p><strong>Objective</strong>: We want to construct two-sided STIs for each component of <span class="math inline">\(\mathbf{X} = (X_1, X_2, \dots, X_p)'\)</span>. That is, we want to find a region of the form <span class="math inline">\((c_1, d_1) \times (c_2, d_2) \times \dots \times (c_p, d_p)\)</span> where <span class="math inline">\(c_j\)</span> and <span class="math inline">\(d_j\)</span>, <span class="math inline">\(j = 1, 2, \dots, p\)</span>, are functions of the random sample <span class="math inline">\(\mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n\)</span> such that</p>
<p><span class="math display">\[
P_{\mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n} \left\{ P_{X_j} \left(c_j &lt; X_j &lt;d_j \mid \mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n \right) \ge \gamma, \forall j = 1, 2, \dots, p \right\} = 1 - \alpha
\]</span></p>
<p>The quantities <span class="math inline">\(\gamma\)</span> and <span class="math inline">\(\left( 1-\alpha\right)\)</span> are between 0 and 1 and are referred to as the <strong>content probability</strong> and <strong>confidence level</strong>.</p>
<p><strong>Criterion</strong>: With a confidence level of <span class="math inline">\(100(1-\alpha)\%\)</span>, each marginal interval <span class="math inline">\((c_j, d_j), j = 1, 2, \dots, p\)</span>, should have a content of at least <span class="math inline">\(\gamma\)</span>.</p>
</section>
<section id="one-sided-sti" class="level3">
<h3 class="anchored" data-anchor-id="one-sided-sti">One sided STI</h3>
<p><strong>Objective</strong>: We want to construct 1-sided STIs.</p>
<p>These only have either lower limits only or upper limits only. That is, we want to find a region of the forms</p>
<p><span class="math display">\[
(c_1, \infty) \times (c_2, \infty) \times \dots, (c_p, \infty)
\]</span></p>
<p>and</p>
<p><span class="math display">\[
(-\infty, d_1) \times (-\infty, d_2) \times \dots (-\infty, d_p)
\]</span></p>
<p>where <span class="math inline">\(c_j\)</span> and <span class="math inline">\(d_j\)</span>, <span class="math inline">\(j=1, 2, \dots p\)</span>, are still functions of the random sample <span class="math inline">\(\mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n\)</span>, such that</p>
<p><span class="math display">\[
P_{\mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n} \left\{ P_{X_j} \left(X_j &gt; c_j \mid \mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n \right) \ge \gamma, \forall j = 1, 2, \dots, p \right\} = 1 - \alpha
\]</span></p>
<p>and</p>
<p><span class="math display">\[
P_{\mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n} \left\{ P_{X_j} \left(X_j &lt; d_j \mid \mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n \right) \ge \gamma, \forall j = 1, 2, \dots, p \right\} = 1 - \alpha
\]</span></p>
<p><strong>Idea</strong>:The process of obtaining simultaneous tolerance limits for the random vector <span class="math inline">\(X = \left( X_1, X_2, \dots, X_p \right)\)</span> with <span class="math inline">\(p\)</span>-variate distribution <span class="math inline">\(F_X(\cdot)\)</span> can also be thought of as constructing simultaneous tolerance limits for the <span class="math inline">\(p\)</span> populations represented by the <span class="math inline">\(p\)</span> components of <span class="math inline">\(\mathbf{X}\)</span>.</p>
<p><strong>Notes</strong>: Methodologies here make no assumptions about the correlation structure of <span class="math inline">\(\mathbf{X}\)</span> and so procedures also apply to case where <span class="math inline">\(X_1, X_2, \dots, X_p\)</span> are independent.</p>
</section>
<section id="method-nonparametric-two-sided-stis" class="level3">
<h3 class="anchored" data-anchor-id="method-nonparametric-two-sided-stis">Method: Nonparametric two-sided STIs</h3>
<p>Reference: Lucagbo (2021), who develops nonparametric rectangular tolerance regions. The main idea of the proposed methods is to transform each component in <span class="math inline">\(\mathbf{X}\)</span>.</p>
<p>Let <span class="math inline">\(F_j(\cdot)\)</span> be the CDF of the continuous random variable <span class="math inline">\(X_j\)</span>, the <span class="math inline">\(j\)</span>th component of <span class="math inline">\(\mathbf{X}\)</span>. Moreover, let <span class="math inline">\(k \equiv k(\mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n)\)</span> and <span class="math inline">\(k' \equiv k'(\mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n)\)</span> be some functions of the random sample. The <span class="math inline">\(\gamma\)</span>-content, <span class="math inline">\(100(1-\alpha)\%\)</span> confidence two-sided STIs for <span class="math inline">\(\mathbf{X}\)</span> are set to be of the following form:</p>
<p><span class="math display">\[
\prod^p_{j=1} \left( F^{-1}_j (k'), F^{-1}_j(k) \right)
\]</span></p>
<p>For each <span class="math inline">\(j = 1, 2, \dots, p\)</span>, the end points of the <span class="math inline">\(j\)</span>th interval are expressed as quantiles of <span class="math inline">\(X_j\)</span>. And aligned with the criterion, the values of <span class="math inline">\(k\)</span> and <span class="math inline">\(k'\)</span> are computed to satisfy the following condition:</p>
<p><span class="math display">\[
P_{\mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n} \left\{ P_{X_j} \left(F_j^{-1} \left(k'\right) &lt; X_j &lt; F_j^{-1} \left(k\right) \mid \mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n \right) \ge \gamma, \forall j = 1, 2, \dots, p \right\} = 1 - \alpha
\]</span></p>
<p>Equivalently,</p>
<p><span class="math display">\[
P_{\mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n} \left\{ P_{X_j} \left( k' &lt; F \left( X_j \right) &lt; k \mid \mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n \right) \ge \gamma, \forall j = 1, 2, \dots, p \right\} = 1 - \alpha
\]</span></p>
<p>Note that <span class="math inline">\(F_j(X_j), j = 1, 2, \dots, p\)</span> are identically distributed as <span class="math inline">\(U(0, 1)\)</span> random variables. Hence, the choice of common <span class="math inline">\(k\)</span> and <span class="math inline">\(k'\)</span> for the <span class="math inline">\(p\)</span> components.</p>
<p>Moreover, using the symmetry property of the uniform distribution, we can choose <span class="math inline">\(k'\)</span> as <span class="math inline">\(1-k\)</span> (ex: Since <span class="math inline">\(k' &lt; k\)</span>, let k = 0.7. Since dist is uniform, its max is 1. Hence, <span class="math inline">\(k' = 1 - k = 1-0.7 = 0.3 \rightarrow k'=0.3 &lt; k=0.7\)</span>). Thus, the criterion can be written as</p>
<p><span class="math display">\[
P_{\mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n} \left\{ P_{X_j} \left( 1-k &lt; F_j \left( X_j \right) &lt; k \mid \mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n \right) \ge \gamma, \forall j = 1, 2, \dots, p \right\} = 1 - \alpha
\\
\Rightarrow
\\
P_{\mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n} \left\{ \min\limits_{1 \le j \le p} P_{X_j} \left( 1-k &lt; F_j \left( X_j \right) &lt; k \mid \mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n \right) \ge \gamma \right\} = 1 - \alpha \
\\\text{take the min prob across j for w/c the prob that at least proportion gamma is within the interval}
\\
\text{this is mostly correct/acceptable prob for all j than taking the max one}
\]</span></p>
<p>Since the CDF <span class="math inline">\(F_j(\cdot), j = 1, 2, \dots p\)</span> are unknown, we estimate them marginally via KDE, through the procedure in <a href="#definitions">definitions section</a></p>
<p><span class="math display">\[
P_{\mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n} \left\{ \min\limits_{1 \le j \le p} P_{X_j} \left( 1-k &lt; \hat{F}_j \left( X_j \right) &lt; k \mid \mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n \right) \ge \gamma \right\} = 1 - \alpha
\]</span></p>
<p>is also equivalent to</p>
<p><span class="math display">\[
P_{\mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n} \left\{ \min\limits_{1 \le j \le p} P_{X_j} \left( \max \left\{ \hat{F}_j(X_j) , 1 - \hat{F}_j(X_j)\right\} \left( X_j \right) &lt; k \mid \mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n \right) \ge \gamma \right\} = 1 - \alpha
\]</span></p>
<p>Explanation:</p>
<p><span class="math display">\[
1-k &lt; \hat{F}_j \left( X_j \right) &lt; k
\\
\equiv
\\
1-k &lt; \hat{F}_j\left( X_j \right) \ \text{and} \  \hat{F}_j \left( X_j \right) &lt; k
\\
\equiv
\\
1-\hat{F}_j\left( X_j \right) &lt; k \ \text{and} \  \hat{F}_j \left( X_j \right) &lt; k
\\
\text{this shows that both 1-F and F are less than k and is mathematically equal to saying}
\\
\max \left\{ \hat{F}_j(X_j) , 1 - \hat{F}_j(X_j)\right\} &lt; k
\]</span></p>
<p>Define <span class="math inline">\(Y_j = \max \left\{ \hat{F}_j(X_j) , 1 - \hat{F}_j(X_j)\right\}\)</span> and disregard the “minimum” condition for now.</p>
<p>Notice <span class="math inline">\(k\)</span> is consistent with the definition of upper tolerance limit of the random variable <span class="math inline">\(Y_j\)</span> (see: <a href="#one-sided-sti">1-sided STI</a>). So, if we focus only on one component <span class="math inline">\(Y_j\)</span>, we could estimate <span class="math inline">\(k\)</span> by the upper tolerance limit of <span class="math inline">\(Y_j\)</span> to be computed from the data using <a href="#definitions">this procedure</a> (nonparametric tolerance intervals) by computing the nonparametric upper tolerance limit based on <span class="math inline">\(Y_{1j}, Y_{2j}, \dots, Y_{nj}\)</span>, where <span class="math inline">\(Y_{ij} = \max \left\{ \hat{F}_j(X_{ij}) , 1 - \hat{F}_j(X_{ij})\right\}, i=1,2,\dots,n\)</span>.</p>
<p>Since <span class="math inline">\(p&gt;1\)</span> and to account for the “minimum” condition (This means that the weakest (i.e., smallest) probability across all <span class="math inline">\(p\)</span> dimensions should still meet the threshold <span class="math inline">\(\gamma\)</span>), we obtain an estimate of <span class="math inline">\(k\)</span>, say <span class="math inline">\(\hat{k}\)</span>, by taking the maximum of the marginal upper tolerance limits of the <span class="math inline">\(Y_j\)</span>s.</p>
<p><span class="math display">\[
\hat{k} = \max \left\{ k_1, k_1, \dots, k_p\right\}
\]</span></p>
<p>where <span class="math inline">\(k_j\)</span> is a marginal upper tolerance limit for the probability condition in dimension <span class="math inline">\(j\)</span>.</p>
<p>Using this conservative estimate <span class="math inline">\(\hat{k}\)</span> ensures that the minimum of the inner probabilities as shown below is at least <span class="math inline">\(\gamma\)</span>; i.e., in at least <span class="math inline">\((1-\alpha)\)</span> fraction of all datasets, the weakest probability among all <span class="math inline">\(p\)</span> dimensions meets of exceeds <span class="math inline">\(\gamma\)</span></p>
<p><span class="math display">\[
P_{\mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n} \left\{ \min\limits_{1 \le j \le p} P_{X_j} \left( \max \left\{ \hat{F}_j(X_j) , 1 - \hat{F}_j(X_j)\right\}  &lt; \hat{k} \mid \mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n \right) \ge \gamma \right\} = 1 - \alpha
\]</span></p>
<p>Now, going back to the original form:</p>
<p><span class="math display">\[
P_{\mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n} \left\{ P_{X_j} \left(F_j^{-1} (1-\hat{k}) &lt; X_j &lt; F_j^{-1} (\hat{k}) \mid \mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n \right) \ge \gamma, \forall j = 1, 2, \dots, p \right\} = 1 - \alpha
\]</span></p>
<p>We say, the <span class="math inline">\(\gamma\)</span>-content, <span class="math inline">\(100(1-\alpha)\%\)</span> confidence two sided STIs for the data are given by</p>
<p><span class="math display">\[
\prod^p_{j=1}\left( c_j, d_j \right) = \prod^p_{j=1}\left( \hat{F}_j^{-1}(1-\hat{k}), \hat{F}_j^{-1}(\hat{k}) \right)
\]</span></p>
<p><strong>Algorithm A: Nonparametric two-sided STIs</strong></p>
<ol type="1">
<li>Data are given by <span class="math inline">\(\mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n \overset{iid}{\sim}F_{\mathbf{X}}(\mathbf{x})\)</span> where <span class="math inline">\(\mathbf{X}_i = \left( X_{i1}, X_{i2}, \dots, X_{ip}\right)'\)</span> is a <span class="math inline">\((p \times 1)\)</span> vector of measurements taken from the <span class="math inline">\(i\)</span>th subject, <span class="math inline">\(i = 1, 2, \dots, n\)</span>. Also <span class="math inline">\(F_{\mathbf{X}}(\mathbf{x})\)</span> is some unknown (continuous) distribution, where <span class="math inline">\(F_j(x)\)</span> is the unknown distribution of the <span class="math inline">\(j\)</span>th component</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>get_sigma_matrices <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">p =</span> <span class="dv">3</span>) {</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  sigma_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sigma_01  =</span> <span class="fl">0.05</span> <span class="sc">*</span> <span class="fu">diag</span>(p) <span class="sc">+</span> <span class="fl">0.95</span> <span class="sc">*</span> <span class="fu">matrix</span>(<span class="dv">1</span>, p, p),</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sigma_02  =</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">diag</span>(p) <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">matrix</span>(<span class="dv">1</span>, p, p),</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sigma_03  =</span> <span class="fl">0.8</span> <span class="sc">*</span> <span class="fu">diag</span>(p) <span class="sc">+</span> <span class="fl">0.2</span> <span class="sc">*</span> <span class="fu">matrix</span>(<span class="dv">1</span>, p, p)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (p <span class="sc">==</span> <span class="dv">3</span>) {</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    extra <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">Sigma_04 =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.95</span>, <span class="sc">-</span><span class="fl">0.95</span>,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>                          <span class="sc">-</span><span class="fl">0.95</span>, <span class="dv">1</span>, <span class="fl">0.95</span>,</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>                          <span class="sc">-</span><span class="fl">0.95</span>, <span class="fl">0.95</span>, <span class="dv">1</span>), <span class="dv">3</span>, <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">Sigma_05 =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.5</span>,</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>                          <span class="sc">-</span><span class="fl">0.5</span>, <span class="dv">1</span>, <span class="fl">0.5</span>,</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>                          <span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), <span class="dv">3</span>, <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">Sigma_06 =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.2</span>, <span class="sc">-</span><span class="fl">0.2</span>,</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>                          <span class="sc">-</span><span class="fl">0.2</span>, <span class="dv">1</span>, <span class="fl">0.2</span>,</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>                          <span class="sc">-</span><span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="dv">1</span>), <span class="dv">3</span>, <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">Sigma_07 =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.9</span>, <span class="fl">0.5</span>,</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>                          <span class="fl">0.9</span>, <span class="dv">1</span>, <span class="fl">0.1</span>,</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>                          <span class="fl">0.5</span>, <span class="fl">0.1</span>, <span class="dv">1</span>), <span class="dv">3</span>, <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">Sigma_08 =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>,</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>                          <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="fl">0.95</span>,</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>                          <span class="fl">0.5</span>, <span class="fl">0.95</span>, <span class="dv">1</span>), <span class="dv">3</span>, <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">Sigma_09 =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>,</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>                          <span class="fl">0.2</span>, <span class="dv">1</span>, <span class="fl">0.95</span>,</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>                          <span class="fl">0.2</span>, <span class="fl">0.95</span>, <span class="dv">1</span>), <span class="dv">3</span>, <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">Sigma_10 =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.5</span>,</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>                          <span class="sc">-</span><span class="fl">0.5</span>, <span class="dv">1</span>, <span class="fl">0.95</span>,</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>                          <span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.95</span>, <span class="dv">1</span>), <span class="dv">3</span>, <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>    sigma_list <span class="ot">&lt;-</span> <span class="fu">c</span>(sigma_list, extra)</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sigma_list)</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>sigma_p3 <span class="ot">&lt;-</span> <span class="fu">get_sigma_matrices</span>(<span class="at">p =</span> <span class="dv">3</span>)</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>sigma_p2 <span class="ot">&lt;-</span> <span class="fu">get_sigma_matrices</span>(<span class="at">p =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#library("compositions")</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"MASS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="fl">0.95</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>MyVar <span class="ot">&lt;-</span> sigma_p3[<span class="dv">1</span>]<span class="sc">$</span>Sigma_01</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>MyMean <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,p)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co"># STEP 1: Generate the random sample X1,X2,:::,Xn from the multivariate lognormal distribution</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) <span class="co"># for reproducibility</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>log_data <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(<span class="at">n =</span> n, <span class="at">mu =</span> MyMean, <span class="at">Sigma =</span> MyVar)</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to lognormal data by exponentiation</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">exp</span>(log_data)</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(X) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"p_"</span>, <span class="fu">sprintf</span>(<span class="st">"%03d"</span>, <span class="fu">seq</span>(p)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>base_colors <span class="ot">&lt;-</span> <span class="fu">adjustcolor</span>(<span class="fu">rainbow</span>(p), <span class="at">alpha.f =</span> <span class="fl">0.25</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Limit to first p columns</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>colors_to_use <span class="ot">&lt;-</span> base_colors[<span class="dv">1</span><span class="sc">:</span>p]</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>columns_to_plot <span class="ot">&lt;-</span> X[, <span class="dv">1</span><span class="sc">:</span>p, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, p<span class="sc">+</span><span class="dv">1</span>))</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up plot</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(columns_to_plot[,<span class="dv">1</span>], </span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> colors_to_use[[<span class="dv">1</span>]], </span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">range</span>(X), </span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Overlaid Histograms"</span>, </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"exp(log_x)"</span>)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Add remaining histograms</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (p <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>p) {</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist</span>(columns_to_plot[,i], </span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> colors_to_use[[i]], </span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, </span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">colnames</span>(columns_to_plot), </span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="fu">unlist</span>(colors_to_use))</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (p <span class="cf">in</span> <span class="fu">seq</span>(p)) {</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>((X[,p]), <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"p_"</span>, <span class="fu">sprintf</span>(<span class="st">"%03d"</span>, p)), <span class="at">xlab =</span> <span class="st">"exp(log_x)"</span>, <span class="at">col =</span> colors_to_use[[p]])</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="initial_notes_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>For each <span class="math inline">\(j = 1, 2, \dots, p\)</span>, obtain the estimate <span class="math inline">\(\hat{F}_j(x)\)</span> via KDE using <span class="math inline">\(X_{1j}, X_{2j}, \dots, X_{nj}\)</span>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>kde_cdf_function <span class="ot">&lt;-</span> <span class="cf">function</span>(datapoints, bandwidth) {</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="cf">function</span>(x) <span class="fu">mean</span>(<span class="fu">pnorm</span>((x <span class="sc">-</span> datapoints) <span class="sc">/</span> bandwidth)))</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>Fhat_Xj <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_len</span>(<span class="fu">ncol</span>(X)), <span class="cf">function</span>(j) {</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kde_cdf_function</span>(X[, j], <span class="fu">find_silver_bw</span>(X[, j]))</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Fhat_Xj) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Fhat_X"</span>, <span class="fu">seq_len</span>(<span class="fu">ncol</span>(X)))</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>Fhat_Xj</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Fhat_X1
function (x) 
mean(pnorm((x - datapoints)/bandwidth))
&lt;environment: 0x56425c7522f8&gt;

$Fhat_X2
function (x) 
mean(pnorm((x - datapoints)/bandwidth))
&lt;bytecode: 0x56425bfef168&gt;
&lt;environment: 0x56425c599580&gt;

$Fhat_X3
function (x) 
mean(pnorm((x - datapoints)/bandwidth))
&lt;bytecode: 0x56425bfef168&gt;
&lt;environment: 0x56425bfebad0&gt;</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Compute <span class="math inline">\(U_{ij} = \hat{F}_j(X_{ij}), i = 1, 2, \dots, n\)</span> and <span class="math inline">\(j = 1, 2, \dots, p\)</span></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: compute estimates at each data point</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>U_ij <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_len</span>(<span class="fu">ncol</span>(X)), <span class="cf">function</span>(j) {</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(X[, j], Fhat_Xj[[j]])</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(U_ij) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"U_i"</span>, <span class="fu">seq_len</span>(<span class="fu">ncol</span>(X)))</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate CDFs and evaluate at data points</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(p)) {</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  U_ij[[i]] <span class="ot">&lt;-</span> <span class="fu">sapply</span>(X[, i], Fhat_Xj[[i]])</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Overlay dot plots in one figure</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(X[,<span class="dv">1</span>], U_ij[[<span class="dv">1</span>]], <span class="at">col =</span> colors_to_use[<span class="dv">1</span>], <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"exp(log_x)"</span>, <span class="at">ylab =</span> <span class="st">"U_ij"</span>,</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Overlaid Estimated CDFs"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>p) {</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(X[, i], U_ij[[i]], <span class="at">col =</span> colors_to_use[i], <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional legend</span></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend =</span> <span class="fu">paste0</span>(<span class="st">"U_i"</span>, <span class="dv">1</span><span class="sc">:</span>p),</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> colors_to_use, <span class="at">pch =</span> <span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="initial_notes_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is an aside: Getting the estimated PDF from the estimated CDF.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>base_colors <span class="ot">&lt;-</span> <span class="fu">adjustcolor</span>(<span class="fu">rainbow</span>(p), <span class="at">alpha.f =</span> <span class="fl">0.2</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>colors_to_use <span class="ot">&lt;-</span> base_colors[<span class="dv">1</span><span class="sc">:</span>p]</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>base_colors_kde <span class="ot">&lt;-</span> <span class="fu">adjustcolor</span>(<span class="fu">rainbow</span>(p), <span class="at">alpha.f =</span> .<span class="dv">75</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>colors_to_use_kde <span class="ot">&lt;-</span> base_colors_kde[<span class="dv">1</span><span class="sc">:</span>p]</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">3</span>  <span class="co"># number of individual plots</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, p <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>base_colors <span class="ot">&lt;-</span> <span class="fu">adjustcolor</span>(<span class="fu">rainbow</span>(p), <span class="at">alpha.f =</span> <span class="fl">0.25</span>)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>colors_to_use <span class="ot">&lt;-</span> base_colors[<span class="dv">1</span><span class="sc">:</span>p]</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Combined overlay histogram (spans entire first row)</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(X[, <span class="dv">1</span>], <span class="at">col =</span> colors_to_use[<span class="dv">1</span>], <span class="at">xlim =</span> <span class="fu">range</span>(X), <span class="at">main =</span> <span class="st">"Overlaid Histograms"</span>,</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"exp(log_x)"</span>, <span class="at">freq =</span> <span class="cn">FALSE</span>,<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">20</span>,<span class="fu">find_silver_bw</span>(X[, <span class="dv">1</span>])), <span class="at">border=</span><span class="cn">NA</span>)</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>p) {</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(X[, i], <span class="at">col =</span> colors_to_use[i], <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">freq =</span> <span class="cn">FALSE</span>,<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">20</span>,<span class="fu">find_silver_bw</span>(X[, i])), <span class="at">border=</span><span class="cn">NA</span>)</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">colnames</span>(X)[<span class="dv">1</span><span class="sc">:</span>p], <span class="at">fill =</span> colors_to_use)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Individual histograms with KDE overlays (second row)</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_len</span>(p)) {</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate y-limits dynamically</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> <span class="fu">hist</span>(X[, j], <span class="at">plot =</span> <span class="cn">FALSE</span>, <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">warn.unused=</span><span class="cn">FALSE</span>)</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>  grid <span class="ot">&lt;-</span> <span class="fu">get_grid</span>(X[, j])</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>  kde_vals <span class="ot">&lt;-</span> <span class="fu">kde_manual</span>(grid, X[, j], <span class="fu">find_silver_bw</span>(X[, j]))</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>  y_max <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">max</span>(h<span class="sc">$</span>density), <span class="fu">max</span>(kde_vals))</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(X[, j], <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"p_"</span>, <span class="fu">sprintf</span>(<span class="st">"%03d"</span>, j)),<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">20</span>,<span class="fu">find_silver_bw</span>(X[, j])),</span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">"exp(log_x)"</span>, <span class="at">col =</span> colors_to_use[j], <span class="at">freq =</span> <span class="cn">FALSE</span>,<span class="at">border=</span><span class="cn">NA</span>)</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(grid, kde_vals, <span class="at">col =</span> <span class="fu">adjustcolor</span>(colors_to_use_kde[j], <span class="at">alpha.f =</span> <span class="dv">1</span>), <span class="at">lwd =</span> <span class="dv">1</span>)</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="initial_notes_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li>Compute <span class="math inline">\(Y_{ij} = \max \left\{ U_{ij}, 1-U_{ij} \right\}, i = 1, 2, \dots, n\)</span> and <span class="math inline">\(j = 1, 2, \dots, p\)</span></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>Y_ij <span class="ot">&lt;-</span> <span class="fu">lapply</span>(U_ij, <span class="cf">function</span>(U) {</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pmax</span>(U, <span class="dv">1</span> <span class="sc">-</span> U)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Y_ij) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Y_i"</span>, <span class="fu">seq_len</span>(<span class="fu">ncol</span>(X)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="5" type="1">
<li>For each <span class="math inline">\(j=1, 2, \dots, p\)</span>, compute the <span class="math inline">\(\gamma\)</span>-content, <span class="math inline">\(100(1-\alpha)\%\)</span>-confidence nonparametric upper tolerance limit based on <span class="math inline">\(Y_{1j}, Y_{2j}, \dots, Y_{nj}\)</span> using the methodology <a href="#definitions">here</a> (nonparametric tolerance intervals). Call this <span class="math inline">\(k_j, j = 1, 2, \dots, p\)</span></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>k_j <span class="ot">&lt;-</span> <span class="fu">lapply</span>(Y_ij, <span class="cf">function</span>(Y) {</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nptol.int</span>(Y, </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> alpha, </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">P =</span> gamma, </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">side =</span> <span class="dv">1</span>, </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"WILKS"</span>,</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">upper =</span> <span class="cn">NULL</span>,</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">lower =</span> <span class="cn">NULL</span>)<span class="sc">$</span><span class="st">`</span><span class="at">1-sided.upper</span><span class="st">`</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(k_j) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"k_"</span>, <span class="fu">seq_len</span>(<span class="fu">ncol</span>(X)))</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>k_j</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$k_1
[1] 0.9673421

$k_2
[1] 0.9651831

$k_3
[1] 0.9663632</code></pre>
</div>
</div>
<ol start="6" type="1">
<li>Get the maximum of the <span class="math inline">\(k_j\)</span>s. Call this <span class="math inline">\(\hat{k} = \max\{k_1, k_2, \dots, k_p\}\)</span></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>k_hat <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">unlist</span>(k_j))</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>k_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9673421</code></pre>
</div>
</div>
<ol start="7" type="1">
<li>For each <span class="math inline">\(j=1, 2, \dots, p\)</span>, compute <span class="math inline">\(c_j =\hat{F}_j^{-1}(1-\hat{k})\)</span> and <span class="math inline">\(d_j = \hat{F}_j^{-1}(\hat{k})\)</span></li>
<li>The <span class="math inline">\(\gamma\)</span>-content, <span class="math inline">\(100(1-\alpha)\%\)</span>-confidence nonparametric two-sided STIs are given by <span class="math inline">\((c_j, d_j), j =1, 2, \dots, p\)</span></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>cj_dj <span class="ot">&lt;-</span> <span class="fu">lapply</span>(Fhat_Xj, <span class="cf">function</span>(Fhat) {</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  f.inv <span class="ot">&lt;-</span> <span class="fu">inverse</span>(Fhat, <span class="at">lower =</span> <span class="sc">-</span><span class="dv">100</span>, <span class="at">upper =</span> <span class="dv">100</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="fu">f.inv</span>(<span class="dv">1</span> <span class="sc">-</span> k_hat), <span class="fu">f.inv</span>(k_hat)), <span class="fu">c</span>(<span class="st">"c_j"</span>, <span class="st">"d_j"</span>))</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cj_dj) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Finv_i"</span>, <span class="fu">seq_len</span>(<span class="fu">ncol</span>(X)))</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>cj_dj</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Finv_i1
        c_j         d_j 
-0.04147688  5.57905136 

$Finv_i2
        c_j         d_j 
-0.02164378  5.47784699 

$Finv_i3
         c_j          d_j 
-0.004980373  5.764457577 </code></pre>
</div>
</div>
<p>common <span class="math inline">\(\hat{k}\)</span> is to be used across all estimated distributions <span class="math inline">\(\hat{F}_j\)</span></p>
</section>
<section id="evaluation-nonparametric-two-sided-stis" class="level3">
<h3 class="anchored" data-anchor-id="evaluation-nonparametric-two-sided-stis">Evaluation: Nonparametric two-sided STIs</h3>
<p>This is aimed to evaluate the performance of the proposed methodology.</p>
<ul>
<li>To reflect the potential skewness of the observations, the data are generated from a multivariate lognormal distribution with mean vector <span class="math inline">\(\mathbf{0}\)</span> and covariance matrix <span class="math inline">\(\Sigma\)</span> in logarithmic scale.</li>
<li>DGP will be done using “compositions” R package.</li>
<li>The confidence level and content are set at <span class="math inline">\(1-\alpha=0.95\)</span> and <span class="math inline">\(\gamma = 0.95\)</span>.</li>
<li>We use the sample sizes <span class="math inline">\(n =100,n=300\)</span>, and <span class="math inline">\(n=500\)</span> for the simulations.</li>
<li>The covariance matrix <span class="math inline">\(\Sigma\)</span> is also varied to represent different correlation structures. We run simulations for the values of <span class="math inline">\(\Sigma\)</span> of the form <span class="math inline">\((1-\rho)\mathbf{I}_p + \rho1_p1_p'\)</span>. Here <span class="math inline">\(\mathbf{I}_p\)</span> is the <span class="math inline">\((p \times p)\)</span> identity matrix and <span class="math inline">\(1_p\)</span> is a <span class="math inline">\((p \times 1)\)</span> column vector of 1s. This choice of <span class="math inline">\(\Sigma\)</span> is a correlation matrix that assumes an exchangeable correlation structure. We run simulations for <span class="math inline">\(p=2\)</span> and <span class="math inline">\(p=3\)</span> for the ff covariances in <code>sigma_p2/sigma_p3</code></li>
</ul>
<p>The choices for the covariance matrices <span class="math inline">\(\Sigma_1\)</span> to <span class="math inline">\(\Sigma_{10}\)</span> are made so that they include as wide variety as possible of the correlation values in terms of both size and direction.</p>
<p>Aside: An exchangeable variance-covariance matrix is a structured covariance matrix where all off-diagonal elements are equal, meaning that each pair of variables has the same covariance.</p>
<p><strong>Univariate case</strong></p>
<p>Furthermore, although this study is primarily concerned with multivariate measurements, we shall also investigate the performance of the KDE-based method in the univariate case and compare it with the performance of the standard approach to compute nonparametric tolerance intervals, which is that of Wilks (1941).</p>
<ul>
<li>For the univariate case, we generate the simulated samples from the univariate lognormal distribution with log-scale mean 0.</li>
<li>The log-scale variances used are <span class="math inline">\(\sigma^2 = 0.95, \sigma^2=0.5\)</span>, and <span class="math inline">\(\sigma^2 = 0.20\)</span>.</li>
</ul>
<p>Note that since the proposed methods apply mainly to the multivariate case, in the univariate care we refrain from saying “proposed method”, and instead say “KDE-based method” even though the univariate case is a special case of the multivariate case.</p>
<p>The Gaussian kernel is used in obtaining the KDE. Moreover, the bandwidth <span class="math inline">\(h\)</span> used in the simulations is Silverman’s rule of thumb, which is the preferred bandwidth for the Gaussian kernel. Some numerical simulations (not reported here) have also been performed using a different bandwidth choice and the results are very similar.</p>
<p>In Step 7 of Algorithm A, the inverse of the estimated distribution functions are calculated using the <code>GoFKernel</code> R package. In addition, nonparametric tolerance limits described are implemented in R through the <code>tolerance</code> R package. To estimate the coverage probability, this study uses <span class="math inline">\(M=5000\)</span> simulated samples in running Monte Carlo simulations.</p>
<p>To evaluate, look at the estimated coverage probabilities. The desired or nominal confidence level is 0.95. Also compute the expected lengths of the tolerance intervals for each component for algorithm A.</p>
<p><strong>Algorithm: Performance evaluation of the Nonparametric two-sided STIs obtained from Algo A through estimated coverage probability and expected lengths</strong></p>
<ol type="1">
<li><p>Generate the random sample <span class="math inline">\(\mathbf{X}_1, \mathbf{X}_2, \dots, \mathbf{X}_n\)</span> from the multivariate lognormal distribution with log-scale mean <span class="math inline">\(\boldsymbol{\mu}\)</span> and given log-scale covariance matrix <span class="math inline">\(\Sigma\)</span>. Let <span class="math inline">\(\mu_j\)</span> be the <span class="math inline">\(j\)</span>th element of <span class="math inline">\(\boldsymbol{\mu}\)</span> and <span class="math inline">\(\sigma^2_j\)</span> be the <span class="math inline">\(j\)</span>th diagonal element of <span class="math inline">\(\Sigma\)</span>.</p></li>
<li><p>Compute the 2-sided tolerance limits <span class="math inline">\(c_j\)</span> and <span class="math inline">\(d_j\)</span>, <span class="math inline">\(j = 1, 2, \dots, p\)</span> using the procedure in Algo A.</p></li>
<li><p>Compute <span class="math inline">\(\min_{1 \leq j \leq p} \left\{ \Phi \left( \log d_j; \mu_j, \sigma^2_j\right) - \Phi \left( \log c_j; \mu_j, \sigma^2_j\right) \right\}\)</span> where <span class="math inline">\(\Phi \left( x; \mu_j, \sigma^2_j\right)\)</span> denotes the CDF of the <span class="math inline">\(N \left( \mu_j, \sigma_j^2 \right)\)</span></p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>get_TI_info <span class="ot">&lt;-</span> <span class="cf">function</span>(tol_int, mu, var) {</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  info <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(tol_int), <span class="cf">function</span>(j) {</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    lower <span class="ot">&lt;-</span> tol_int[[j]][<span class="st">"c_j"</span>]</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    upper <span class="ot">&lt;-</span> tol_int[[j]][<span class="st">"d_j"</span>]</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Coverage on CDF scale (difference of estimated quantiles)</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    coverage <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(upper <span class="sc">-</span> lower)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># TI length on original/lognormal scale</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>    ti_length <span class="ot">&lt;-</span> <span class="fu">plnorm</span>(upper, <span class="at">meanlog =</span> mu[j], <span class="at">sdlog =</span> <span class="fu">sqrt</span>(var[j, j])) <span class="sc">-</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">plnorm</span>(lower, <span class="at">meanlog =</span> mu[j], <span class="at">sdlog =</span> <span class="fu">sqrt</span>(var[j, j]))</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return named vector</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setNames</span>(<span class="fu">c</span>(ti_length, coverage), <span class="fu">c</span>(<span class="st">"TI_length"</span>, <span class="st">"Coverage"</span>))</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Name each component list</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(info) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"p_"</span>, <span class="fu">seq_along</span>(tol_int))</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(info)</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a><span class="fu">get_TI_info</span>(cj_dj, MyMean, MyVar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$p_1
TI_length  Coverage 
0.9571945 5.6205282 

$p_2
TI_length  Coverage 
0.9555015 5.4994908 

$p_3
TI_length  Coverage 
0.9600882 5.7694379 </code></pre>
</div>
</div>
</section>
<section id="simulation-a-full-simulation" class="level3">
<h3 class="anchored" data-anchor-id="simulation-a-full-simulation">Simulation A: Full Simulation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bonferoni</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co"># bonferonni &lt;- function(p_data) {</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   if (length(p_data) &gt;= 119) {</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     to &lt;- nptol.int(p_data, alpha = alpha/3, P = gamma, side = 2, method = "WILKS",</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co">#                   upper = NULL, lower = NULL)</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     lower_bound &lt;- to$`2-sided.lower`</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     upper_bound &lt;- to$`2-sided.upper`</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="co">#       </span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   else {</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     lower_bound &lt;- min(p_data)</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     upper_bound &lt;- max(p_data)</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   return(c(lower_bound, upper_bound))</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>bonferonni <span class="ot">&lt;-</span> <span class="cf">function</span>(p_data) {</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(p_data) <span class="sc">&gt;=</span> <span class="dv">119</span>) {</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>    to <span class="ot">&lt;-</span> <span class="fu">nptol.int</span>(p_data, <span class="at">alpha =</span> alpha <span class="sc">/</span> <span class="dv">3</span>, <span class="at">P =</span> gamma, <span class="at">side =</span> <span class="dv">2</span>, <span class="at">method =</span> <span class="st">"WILKS"</span>,</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>                    <span class="at">upper =</span> <span class="cn">NULL</span>, <span class="at">lower =</span> <span class="cn">NULL</span>)</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>    lower_bound <span class="ot">&lt;-</span> to<span class="sc">$</span><span class="st">`</span><span class="at">2-sided.lower</span><span class="st">`</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>    upper_bound <span class="ot">&lt;-</span> to<span class="sc">$</span><span class="st">`</span><span class="at">2-sided.upper</span><span class="st">`</span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>    lower_bound <span class="ot">&lt;-</span> <span class="fu">min</span>(p_data)</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>    upper_bound <span class="ot">&lt;-</span> <span class="fu">max</span>(p_data)</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">setNames</span>(<span class="fu">c</span>(lower_bound, upper_bound), <span class="fu">c</span>(<span class="st">"c_j"</span>, <span class="st">"d_j"</span>)))</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>bonf_results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_len</span>(<span class="fu">ncol</span>(X)), <span class="cf">function</span>(j) {</span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bonferonni</span>(X[, j])</span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(bonf_results) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Bonf_i"</span>, <span class="fu">seq_along</span>(bonf_results))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>get_TI_info <span class="ot">&lt;-</span> <span class="cf">function</span>(tol_int, mu, var) {</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  tol_int <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(tol_int)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  info <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(tol_int), <span class="cf">function</span>(j) {</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    lower <span class="ot">&lt;-</span> tol_int[<span class="dv">1</span>,j]</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    upper <span class="ot">&lt;-</span> tol_int[<span class="dv">2</span>,j]</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Coverage on CDF scale (difference of estimated quantiles)</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    ti_length <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(upper <span class="sc">-</span> lower)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># TI length on original/lognormal scale</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>    coverage <span class="ot">&lt;-</span> <span class="fu">plnorm</span>(upper, <span class="at">meanlog =</span> mu[j], <span class="at">sdlog =</span> <span class="fu">sqrt</span>(var[j, j])) <span class="sc">-</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">plnorm</span>(lower, <span class="at">meanlog =</span> mu[j], <span class="at">sdlog =</span> <span class="fu">sqrt</span>(var[j, j]))</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return named vector</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setNames</span>(<span class="fu">c</span>(ti_length, coverage), <span class="fu">c</span>(<span class="st">"TI_length"</span>, <span class="st">"Coverage"</span>))</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Name each component list</span></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(info) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"p_"</span>, <span class="fu">seq_along</span>(tol_int))</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(info)</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a><span class="fu">get_TI_info</span>(cj_dj, MyMean, MyVar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$p_1
TI_length  Coverage 
5.6205282 0.9571945 

$p_2
TI_length  Coverage 
5.4994908 0.9555015 

$p_3
TI_length  Coverage 
5.7694379 0.9600882 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_TI_info</span>(bonf_results, MyMean, MyVar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$p_1
TI_length  Coverage 
7.3146278 0.9646748 

$p_2
TI_length  Coverage 
9.6564636 0.9750563 

$p_3
TI_length  Coverage 
7.1378655 0.9628328 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming get_TI_info(), cj_dj, bonf_results, MyMean, MyVar are defined</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Run get_TI_info on both lists</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>ti_info_cj_dj <span class="ot">&lt;-</span> <span class="fu">get_TI_info</span>(cj_dj, MyMean, MyVar)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>ti_info_bonf <span class="ot">&lt;-</span> <span class="fu">get_TI_info</span>(bonf_results, MyMean, MyVar)</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine with prefixed names</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(ti_info_cj_dj, <span class="fu">paste0</span>(<span class="st">"cj_dj_"</span>, <span class="fu">names</span>(ti_info_cj_dj))),</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(ti_info_bonf, <span class="fu">paste0</span>(<span class="st">"bonf_"</span>, <span class="fu">names</span>(ti_info_bonf)))</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a data frame (base R)</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>df_combined <span class="ot">&lt;-</span> <span class="fu">do.call</span>(</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>  rbind,</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="fu">names</span>(combined), <span class="cf">function</span>(nm) {</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>    vals <span class="ot">&lt;-</span> combined[[nm]]</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">source =</span> nm,</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">TI_length =</span> vals[<span class="st">"TI_length"</span>],</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">Coverage =</span> vals[<span class="st">"Coverage"</span>],</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a><span class="co"># View result</span></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_combined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     source TI_length  Coverage
1 cj_dj_p_1  5.620528 0.9571945
2 cj_dj_p_2  5.499491 0.9555015
3 cj_dj_p_3  5.769438 0.9600882
4  bonf_p_1  7.314628 0.9646748
5  bonf_p_2  9.656464 0.9750563
6  bonf_p_3  7.137866 0.9628328</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>run_simulation <span class="ot">&lt;-</span> <span class="cf">function</span>(n, MyMean, MyVar, <span class="at">gamma =</span> <span class="fl">0.90</span>, <span class="at">n_sim =</span> <span class="dv">100</span>) {</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">replicate</span>(n_sim, {</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 1: Simulate lognormal data</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    log_data <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n, <span class="at">mu =</span> MyMean, <span class="at">Sigma =</span> MyVar)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    datas <span class="ot">&lt;-</span> <span class="fu">exp</span>(log_data)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(datas) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"p_"</span>, <span class="fu">seq_along</span>(MyMean))</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames</span>(datas) <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"n_%03d"</span>, <span class="fu">seq_len</span>(n))</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 2: Compute tolerance intervals</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    k_j <span class="ot">&lt;-</span> <span class="fu">apply</span>(datas, <span class="dv">2</span>, get_upper_limit)</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    tols <span class="ot">&lt;-</span> <span class="fu">apply</span>(datas, <span class="dv">2</span>, <span class="cf">function</span>(s) <span class="fu">get_tolerance_interval</span>(s, <span class="at">maxk =</span> <span class="fu">max</span>(k_j)))</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>    bonf <span class="ot">&lt;-</span> <span class="fu">apply</span>(datas, <span class="dv">2</span>, bonferonni)</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 3: Use get_ti_info to compute coverage and width</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>    proposed_info <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">get_TI_info</span>(</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>        tols,</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>        MyMean,</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>        MyVar</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>    bonf_info <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">get_TI_info</span>(</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>        bonf,</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>        MyMean,</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>        MyVar</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 4: Aggregate results</span></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>    I  <span class="ot">&lt;-</span> <span class="fu">min</span>(proposed_info[<span class="st">"Coverage"</span>, ]) <span class="sc">&gt;=</span> gamma</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>    Lj <span class="ot">&lt;-</span> <span class="fu">unlist</span>(proposed_info[<span class="dv">1</span>, ])</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>    Ib  <span class="ot">&lt;-</span> <span class="fu">min</span>(bonf_info[<span class="st">"Coverage"</span>, ]) <span class="sc">&gt;=</span> gamma</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>    Ljb <span class="ot">&lt;-</span> <span class="fu">unlist</span>(bonf_info[<span class="st">"TI_length"</span>, ])</span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">Lj =</span> Lj, <span class="at">I =</span> I, <span class="at">Ljb =</span> Ljb, <span class="at">Ib =</span> Ib)</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 5: Summarize results</span></span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>  I_vals   <span class="ot">&lt;-</span> <span class="fu">sapply</span>(results, <span class="cf">function</span>(res) res<span class="sc">$</span>I)</span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>  Lj_vals  <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">sapply</span>(results, <span class="cf">function</span>(res) res<span class="sc">$</span>Lj))</span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>  Ib_vals  <span class="ot">&lt;-</span> <span class="fu">sapply</span>(results, <span class="cf">function</span>(res) res<span class="sc">$</span>Ib)</span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>  Ljb_vals <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">sapply</span>(results, <span class="cf">function</span>(res) res<span class="sc">$</span>Ljb))</span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_I =</span> <span class="fu">mean</span>(I_vals),</span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">colMeans_Lj =</span> <span class="fu">colMeans</span>(Lj_vals),</span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_Ib =</span> <span class="fu">mean</span>(Ib_vals),</span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">colMeans_Ljb =</span> <span class="fu">colMeans</span>(Ljb_vals),</span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">raw_results =</span> results  <span class="co"># Optional: retain raw simulation results</span></span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(foreach)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect available cores and register parallel backend</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>n_cores <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(n_cores)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>MyMean <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="fl">0.95</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>sigma_list <span class="ot">&lt;-</span> <span class="fu">get_sigma_matrices</span>(<span class="at">p=</span><span class="dv">2</span>)</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>n_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">300</span>, <span class="dv">500</span>)</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>results_df <span class="ot">&lt;-</span> <span class="fu">foreach</span>(<span class="at">n =</span> n_values, <span class="at">.combine =</span> rbind, <span class="at">.packages =</span> <span class="fu">c</span>(<span class="st">"MASS"</span>, <span class="st">"GoFKernel"</span>, <span class="st">"tolerance"</span>)) <span class="sc">%:%</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span>(<span class="at">sigma_name =</span> <span class="fu">names</span>(sigma_list), <span class="at">.combine =</span> rbind) <span class="sc">%dopar%</span> {</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>    MyVar <span class="ot">&lt;-</span> sigma_list[[sigma_name]]</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">run_simulation</span>(n, MyMean, MyVar, gamma, <span class="at">n_sim =</span> <span class="dv">5000</span>)</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create data.frames for proposed and bonferroni methods</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>    proposed_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">n =</span> n,</span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">gamma =</span> gamma,</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">sigma =</span> sigma_name,</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"proposed"</span>,</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_I =</span> res<span class="sc">$</span>mean_I,</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">Lj_1 =</span> res<span class="sc">$</span>colMeans_Lj[<span class="dv">1</span>],</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">Lj_2 =</span> res<span class="sc">$</span>colMeans_Lj[<span class="dv">2</span>]</span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>    bonf_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">n =</span> n,</span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">gamma =</span> gamma,</span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">sigma =</span> sigma_name,</span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"bonferroni"</span>,</span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_I =</span> res<span class="sc">$</span>mean_Ib,</span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">Lj_1 =</span> res<span class="sc">$</span>colMeans_Ljb[<span class="dv">1</span>],</span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">Lj_2 =</span> res<span class="sc">$</span>colMeans_Ljb[<span class="dv">2</span>]</span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(proposed_row, bonf_row)</span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="results" class="level3">
<h3 class="anchored" data-anchor-id="results">Results</h3>
<section id="p-3-two-sided" class="level4">
<h4 class="anchored" data-anchor-id="p-3-two-sided">p = 3 Two sided</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"results_df_p3.RData"</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(results_df_p3, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   n gamma    sigma     method mean_I      Lj_1      Lj_2      Lj_3
 100  0.95 Sigma_01   proposed 0.9400  9.496373  9.426451  9.457114
 100  0.95 Sigma_01 bonferroni 0.9246 13.529148 13.512152 13.581769
 100  0.95 Sigma_02   proposed 0.9224  9.476397  9.454583  9.429717
 100  0.95 Sigma_02 bonferroni 0.8980 13.557224 13.513533 13.567895
 100  0.95 Sigma_03   proposed 0.9092  9.436488  9.456816  9.514163
 100  0.95 Sigma_03 bonferroni 0.8908 13.437192 13.560851 13.440324
 100  0.95 Sigma_04   proposed 0.9252  9.505402  9.410441  9.407397
 100  0.95 Sigma_04 bonferroni 0.9184 13.540863 13.427347 13.364099
 100  0.95 Sigma_05   proposed 0.9218  9.414336  9.385001  9.469016
 100  0.95 Sigma_05 bonferroni 0.8900 13.451716 13.405573 13.382672
 100  0.95 Sigma_06   proposed 0.9162  9.456062  9.448307  9.417581
 100  0.95 Sigma_06 bonferroni 0.8980 13.635608 13.498049 13.417974
 100  0.95 Sigma_07   proposed 0.9252  9.485933  9.463129  9.435450
 100  0.95 Sigma_07 bonferroni 0.9104 13.610213 13.475205 13.546910
 100  0.95 Sigma_08   proposed 0.9352  9.421951  9.449796  9.536372
 100  0.95 Sigma_08 bonferroni 0.9088 13.509756 13.621758 13.627901
 100  0.95 Sigma_09   proposed 0.9326  9.498207  9.451215  9.457437
 100  0.95 Sigma_09 bonferroni 0.9084 13.641917 13.553537 13.508107
 100  0.95 Sigma_10   proposed 0.9306  9.501163  9.443952  9.466741
 100  0.95 Sigma_10 bonferroni 0.9080 13.568412 13.560501 13.618996
 300  0.95 Sigma_01   proposed 0.9546  6.987736  6.975796  6.975661
 300  0.95 Sigma_01 bonferroni 0.9624  9.604331  9.630227  9.636809
 300  0.95 Sigma_02   proposed 0.9324  6.995183  7.014769  6.989628
 300  0.95 Sigma_02 bonferroni 0.9532  9.689917  9.711909  9.695054
 300  0.95 Sigma_03   proposed 0.9352  7.011311  7.007623  6.997655
 300  0.95 Sigma_03 bonferroni 0.9578  9.694466  9.653752  9.692042
 300  0.95 Sigma_04   proposed 0.9426  7.015959  6.980505  6.978948
 300  0.95 Sigma_04 bonferroni 0.9662  9.718292  9.642310  9.626886
 300  0.95 Sigma_05   proposed 0.9356  6.999507  7.007756  6.995460
 300  0.95 Sigma_05 bonferroni 0.9536  9.677869  9.703684  9.696216
 300  0.95 Sigma_06   proposed 0.9360  6.977905  6.999628  7.010432
 300  0.95 Sigma_06 bonferroni 0.9524  9.629321  9.695132  9.695546
 300  0.95 Sigma_07   proposed 0.9354  7.004488  6.982654  6.996523
 300  0.95 Sigma_07 bonferroni 0.9516  9.670867  9.652987  9.690976
 300  0.95 Sigma_08   proposed 0.9454  6.991545  7.010114  7.007085
 300  0.95 Sigma_08 bonferroni 0.9572  9.653466  9.726920  9.712015
 300  0.95 Sigma_09   proposed 0.9448  7.003142  7.012875  7.023069
 300  0.95 Sigma_09 bonferroni 0.9584  9.697583  9.704238  9.720274
 300  0.95 Sigma_10   proposed 0.9374  6.994651  6.985055  6.998118
 300  0.95 Sigma_10 bonferroni 0.9558  9.681742  9.615575  9.636666
 500  0.95 Sigma_01   proposed 0.9556  6.449672  6.450191  6.452175
 500  0.95 Sigma_01 bonferroni 0.9874  9.253450  9.246494  9.260319
 500  0.95 Sigma_02   proposed 0.9346  6.441431  6.445940  6.429047
 500  0.95 Sigma_02 bonferroni 0.9840  9.222195  9.227726  9.225374
 500  0.95 Sigma_03   proposed 0.9274  6.438055  6.432108  6.435164
 500  0.95 Sigma_03 bonferroni 0.9824  9.213446  9.247640  9.235903
 500  0.95 Sigma_04   proposed 0.9418  6.442618  6.455335  6.450027
 500  0.95 Sigma_04 bonferroni 0.9892  9.242553  9.259845  9.255597
 500  0.95 Sigma_05   proposed 0.9340  6.423071  6.430700  6.433542
 500  0.95 Sigma_05 bonferroni 0.9818  9.198471  9.209359  9.194897
 500  0.95 Sigma_06   proposed 0.9294  6.446906  6.453713  6.426771
 500  0.95 Sigma_06 bonferroni 0.9828  9.210224  9.251935  9.226937
 500  0.95 Sigma_07   proposed 0.9442  6.440030  6.432327  6.440906
 500  0.95 Sigma_07 bonferroni 0.9856  9.235764  9.221775  9.199010
 500  0.95 Sigma_08   proposed 0.9398  6.448272  6.438224  6.447164
 500  0.95 Sigma_08 bonferroni 0.9866  9.212267  9.219326  9.240178
 500  0.95 Sigma_09   proposed 0.9428  6.452612  6.436362  6.439131
 500  0.95 Sigma_09 bonferroni 0.9838  9.237434  9.227103  9.246770
 500  0.95 Sigma_10   proposed 0.9384  6.447133  6.446725  6.447741
 500  0.95 Sigma_10 bonferroni 0.9852  9.233378  9.214613  9.237776</code></pre>
</div>
</div>
</section>
<section id="p-2-two-sided" class="level4">
<h4 class="anchored" data-anchor-id="p-2-two-sided">p = 2 Two sided</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"results_df_p2.RData"</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(results_df_p2, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   n gamma    sigma     method mean_I      Lj_1      Lj_2
 100  0.95 Sigma_01   proposed 0.9502  9.464721  9.425839
 100  0.95 Sigma_01 bonferroni 0.9432 13.675320 13.580122
 100  0.95 Sigma_02   proposed 0.9464  9.357110  9.416104
 100  0.95 Sigma_02 bonferroni 0.9324 13.320568 13.376452
 100  0.95 Sigma_03   proposed 0.9376  9.373560  9.454572
 100  0.95 Sigma_03 bonferroni 0.9250 13.415416 13.476728
 300  0.95 Sigma_01   proposed 0.9584  6.959330  6.951846
 300  0.95 Sigma_01 bonferroni 0.9722  9.687155  9.681706
 300  0.95 Sigma_02   proposed 0.9514  6.959129  6.977847
 300  0.95 Sigma_02 bonferroni 0.9690  9.663349  9.716652
 300  0.95 Sigma_03   proposed 0.9548  6.975644  6.946055
 300  0.95 Sigma_03 bonferroni 0.9688  9.734940  9.662002
 500  0.95 Sigma_01   proposed 0.9580  6.410187  6.413091
 500  0.95 Sigma_01 bonferroni 0.9890  9.205941  9.211603
 500  0.95 Sigma_02   proposed 0.9444  6.396822  6.402755
 500  0.95 Sigma_02 bonferroni 0.9898  9.223034  9.191342
 500  0.95 Sigma_03   proposed 0.9458  6.412759  6.407571
 500  0.95 Sigma_03 bonferroni 0.9868  9.216039  9.216604</code></pre>
</div>
</div>


</section>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>